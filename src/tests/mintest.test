#
# mintest.test -- multiple interpreter tests
# nca-073-9
# 
# Copyright (c) 1996-2000 by Netcetera AG.
# Copyright (c) 2001 by Apache Software Foundation.
# All rights reserved.
#
# See the file "license.terms" for information on usage and
# redistribution of this file, and for a DISCLAIMER OF ALL WARRANTIES.
#
# @(#) $Id$
#

# -----------------------------------------------------------------------------
# tcltest package
# -----------------------------------------------------------------------------
if {[lsearch [namespace children] ::tcltest] == -1} {
    package require tcltest
    namespace import ::tcltest::*
}

# -----------------------------------------------------------------------------
# 
# -----------------------------------------------------------------------------
test mintest-1.1 {create an interpreter, load websh3 library} {unixOnly} {
    set fn "mintest1_1.tcl"
    set fh [open $fn "w"]
    puts $fh {catch {web::encrypt test} msg}
    puts $fh {set res $msg}
    puts $fh {load $env(WEB_LIBRARY)}
    puts $fh {catch {web::encrypt test} msg}
    puts $fh {lappend res $msg}
    puts $fh {puts $res}
    close $fh
    # find a late available tclsh
    set ok 0
    foreach tclsh {tclsh8.5 tclsh8.4 tclsh8.3 tclsh8.2 tclsh} {
	if {![catch {exec echo return | $tclsh}]} {
	    set ok 1
	    break
	}
    }
    set res ""
    if {$ok} {
	puts "using $tclsh to test loading of $env(WEB_LIBRARY)"
	catch {set res [exec $tclsh $fn]}
    } else {
	error "no reasonable tclsh found"
    }
    file delete -force $fn
    set res
} {invalid command name web::encrypt XDq3pUAU8b}

# cleanup
::tcltest::cleanupTests
