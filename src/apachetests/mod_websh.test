#!/bin/sh
# the next line restarts using tclsh \
    exec tclsh "$0" "$@"

# mod_websh test suite, by David N. Welton <davidw@dedasys.com>

# See README file for more information.

# $Id$

set urlbase "http://localhost:8081/"

# Use this stuff to start and stop the server between tests.

namespace eval server {
}

set server::binname $binname

proc server::start { options code } {
    variable serverpid 0
    variable binname
    after 200
    set serverpid [eval exec $binname -X -f "[file join [pwd] server.conf]" $options &]
    puts "Apache started as PID $serverpid"
    after 200
    catch {
	uplevel $code
    }

    after 100
    exec kill $serverpid
}

# Test stanzas are created by giving the test a name and a
# description.  The code is then executed, and the results
# compared with the desired result, which is placed after the
# block of code.  See man tcltest for more information.

foreach Test {hello.test pool.test headers.test} {
    source $Test
}

::tcltest::cleanupTests
